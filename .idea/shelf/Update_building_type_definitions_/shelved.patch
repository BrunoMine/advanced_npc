Index: data/occupations/default_priest.lua
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>----------------------------------------------------\n-- Basic priest occupation for Advanced NPC (WIP)\n-- By Zorman2000\n----------------------------------------------------\n-- The basic priest occupation is given to NPCs that spawn on houses\n-- surrounding churchs. While on the church, the priest provides\n-- universal wisdom and advice, and also heals the player a limited number of times.\n-- DISCLAIMER: The \"teachings\" in this file come from a compilation of 15 principles shared\n-- among religions around the world. Zorman2000 and other contributors are not\n-- necessarily aligned with the principles and morals in these teachings, nor affiliated\n-- to religions that promote them.\n\nlocal priest_def = {\n    dialogues = {\n        type = \"given\",\n        data = {\n            {\n                text = \"Blessings be upon you, my child!\",\n                tags = {\"unisex\"}\n            },\n            {\n                text = \"The temple will always open the doors to everyone.\",\n                tags = {\"unisex\"}\n            },\n            {\n                text = \"Following the teachings is the path to a good life.\",\n                tags = {\"unisex\"}\n            },\n            {\n                text = \"Thanks for coming to greet me, I hope you have a blessed day! \",\n                tags = {\"unisex\"}\n            },\n            {\n                text = \"Welcome to the temple, how can I help you today?\",\n                flag = {name=\"on_church\", value=true},\n                tags = {\"unisex\"},\n                responses =\n                {\n                    [1] = {\n                        text = \"I'm injured. Can you heal me?\",\n                        action_type = \"function\",\n                        action = function(self, player)\n                            local heal_count = self.flags[\"heal_count\"]\n                            if heal_count then\n                                -- Increase heal count\n                                self.flags[\"heal_count\"] = self.flags[\"heal_count\"] + 1\n                            else\n                                self.flags[\"heal_count\"] = 1\n                                heal_count = 1\n                            end\n                            -- Check if heal count is achieved\n                            if heal_count > 5 then\n                                npc.chat(self.npc_name, player:get_player_name(), \"I cannot heal you anymore, \"\n                                        ..\"my child.\\nTo mortals like you and me, the power of the Creator is\\n\"\n                                        ..\" limited. Only though learning the teachings we are able to understand more\"\n                                        ..\"...\\nBe safe my child.\")\n                            else\n                                npc.chat(self.npc_name, player:get_player_name(),\n                                    \"Receive the blessings of the Creator!\")\n                                effect(self.object:getpos(), 20, \"default_coral_skeleton.png\", 0.1, 0.3, 3, 10)\n                                -- Heal one heart\n                                player:set_hp(player:get_hp() + 2)\n                            end\n                        end\n                    },\n                    [2] = {\n                        text = \"What are your teachings?\",\n                        action_type = \"function\",\n                        action = function(self, player)\n                            local teachings = {\n                                [1] = \"Do unto others what you would have them do unto you\",\n                                [2] = \"Honor your Father and Mother. Knowing them is the key to knowing ourselves\",\n                                [3] = \"Sincerity is the way to heaven,\\nand to think how to be sincere is the way of the man\",\n                                [4] = \"Generosity, charity and kindness will open an individual to an unbounded reservoir of riches\",\n                                [5] = \"Even as the scent dwells within the flower, so God within thine own heart forever abides\",\n                                [6] = \"Acts of faith, prayer and meditation provide us with the strength that allows love for our fellow man to become an abiding force. Love is unifying.\",\n                                [7] = \"Peacemakers are blessed.\\nPeace is the natural result of individuals and nations living in close kinship\",\n                                [8] = \"You reap what you sow.\\nEven if it is a mystery, we are all ruled by this inevitable law of nature\",\n                                [9] = \"The blessings of life are deeper than what can be appreciated by the senses\",\n                                [10] = \"Do no harm, as we are part of the whole, and shouldn't perceive others as foreign or separate from ownself\",\n                                [11] = \"The most beautiful thing a man can do is to forgive wrong\",\n                                [12] = \"Judge not, lest ye be judged. Mankind is nothing but a great family and we all spring from common source\",\n                                [13] = \"Anger clouds the mind in the very moments that clarity and objectivity are needed most.\",\n                                [14] = \"Nature, Being, The Absolute, Creator... whatever name man chooses, there is but one force in the universe. All people and things are of one essence\",\n                                [15] = \"Study the words, no doubt, but look behind them to the thought they indicate;\\nhaving fond it, throw the words away. Live the spirit of them\"\n                            }\n                            npc.chat(self.npc_name, player:get_player_name(), teachings[math.random(1, #teachings)]\n                                    ..\". \\nThese are the teachings of our Creator.\")\n                        end\n                    }\n                }\n            }\n        }\n    },\n    textures = {\n        \"npc_male_priest.png\"\n    },\n    initial_inventory = {\n        {name=\"farming:bread\", count=1}\n    },\n    properties = {\n        initial_trader_status = npc.trade.NONE,\n        enable_gift_items_hints = false\n    },\n\n    building_types = {\n        \"hut\", \"house\", \"farm_tiny\", \"lumberjack\"\n    },\n    surrounding_building_types = {\n        \"church\"\n    },\n    schedules_entries = {\n        [7] = {\n            -- Get out of bed\n            [1] = {\n                task = npc.actions.cmd.USE_BED,\n                args = {\n                    pos = npc.places.PLACE_TYPE.BED.PRIMARY,\n                    action = npc.actions.const.beds.GET_UP\n                }\n            },\n            -- Walk to home inside\n            [2] = {\n                task = npc.actions.cmd.WALK_TO_POS,\n                chance = 95,\n                args = {\n                    end_pos = npc.places.PLACE_TYPE.OTHER.HOME_INSIDE,\n                    walkable = {}\n                }\n            },\n            -- Allow mobs_redo wandering\n            [3] = {action = npc.actions.cmd.FREEZE, args = {freeze = false}}\n        },\n        [8] = {\n            -- Walk to workplace\n            [1] =\n            {\n                task = npc.actions.cmd.WALK_TO_POS,\n                args = {\n                    end_pos = npc.places.PLACE_TYPE.WORKPLACE.PRIMARY,\n                    walkable = {},\n                    use_access_node = true\n                }\n            },\n            [2] =\n            {\n                property = npc.schedule_properties.flag,\n                args = {\n                    action = \"set\",\n                    flag_name = \"on_church\",\n                    flag_value = true\n                }\n            }\n        },\n        [17] = {\n            [1] =\n            {\n                property = npc.schedule_properties.flag,\n                args = {\n                    action = \"set\",\n                    flag_name = \"on_church\",\n                    flag_value = false\n                }\n            },\n            [2] =\n            {\n                task = npc.actions.cmd.WALK_TO_POS,\n                args = {\n                    end_pos = npc.places.PLACE_TYPE.OTHER.HOME_INSIDE,\n                    walkable = {}\n                }\n            }\n        },\n        [21] = {\n            [1] = {\n                task = npc.actions.cmd.WALK_TO_POS,\n                args = {\n                    end_pos = {place_type=npc.places.PLACE_TYPE.BED.PRIMARY, use_access_node=true},\n                    walkable = {}\n                }\n            },\n            -- Use bed\n            [2] = {\n                task = npc.actions.cmd.USE_BED,\n                args = {\n                    pos = npc.places.PLACE_TYPE.BED.PRIMARY,\n                    action = npc.actions.const.beds.LAY\n                }\n            },\n            -- Stay put on bed\n            [3] = {action = npc.actions.cmd.FREEZE, args = {freeze = true}}\n        }\n    }\n}\n\n-- Register occupation\nnpc.occupations.register_occupation(\"basic_priest\", priest_def)
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- data/occupations/default_priest.lua	(date 1505308148000)
+++ data/occupations/default_priest.lua	(revision )
@@ -103,11 +103,9 @@
         enable_gift_items_hints = false
     },
 
-    building_types = {
-        "hut", "house", "farm_tiny", "lumberjack"
-    },
+    building_types = {},
     surrounding_building_types = {
-        "church"
+        {type="church", origin_building_types={"hut", "house", "farm_tiny", "lumberjack"}}
     },
     schedules_entries = {
         [7] = {
